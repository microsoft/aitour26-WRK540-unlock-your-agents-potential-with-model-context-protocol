## 핵심 기술 개요

- **Azure AI Foundry 에이전트 서비스**
  LLM 기반 에이전트를 호스팅하고, 도구(MCP 서버 포함)를 조정하며, 컨텍스트, 코드 인터프리터, 토큰 스트리밍을 관리하고, 인증, 로깅, 확장을 제공합니다.
- **MCP 서버**
  MCP(Model Context Protocol)는 LLM에 외부 도구, API 및 데이터에 대한 통합 인터페이스를 제공하는 개방형 표준입니다. REST용 OpenAPI와 같은 도구 발견을 표준화하고, 요구 사항이 발전함에 따라 도구를 쉽게 업데이트하거나 교체할 수 있게 하여 구성 가능성을 향상시킵니다.
- **PostgreSQL + pgvector**
  관계형 데이터와 임베딩을 저장하고, SQL과 RLS로 관리되는 관계형(SQL) 및 시맨틱(벡터) 쿼리(pgvector를 통해)를 모두 지원합니다.

**함께:** 에이전트 서비스는 사용자 의도를 라우팅하고, MCP 서버는 이를 도구/SQL 호출로 변환하며, PostgreSQL+pgvector는 시맨틱 및 분석 질문에 답합니다.

## 아키텍처 (고수준)

```plaintext
┌─────────────────────┐                         ┌─────────────────┐
│   Zava 에이전트 앱   │       stdio/https       │   MCP 서버      │
│   (app.py)          │◄───────────────────────►│ (sales_analysis)│
│                     │      MCP 전송           └─────────────────┘
│ ┌─────────────────┐ │                                 │
│ │ Azure AI        │ │                                 ▼
│ │ 에이전트 서비스  │ │                         ┌─────────────────┐
│ │ + 스트리밍      │ │                         │ Azure Database  │
│ │                 │ │                         │ for PostgreSQL  │
│ └─────────────────┘ │                         │   + pgvector    │
└─────────────────────┘                         └─────────────────┘
         │                                              |
         ▼                                              ▼
┌─────────────────────┐                         ┌─────────────────┐
│ Azure OpenAI        │                         │ Zava 판매       │
│ 모델 배포           │                         │ 데이터베이스     │
│ - gpt-4o-mini       │                         │ 시맨틱 검색 포함 │
│ - text-embedding-3- │                         └─────────────────┘
│   small             │
└─────────────────────┘
```

## MCP 서버의 주요 장점

- **상호 운용성** – 최소한의 사용자 정의 코드로 AI 에이전트를 모든 벤더의 MCP 지원 도구에 연결합니다.
- **보안 후크** – 로그인, 권한 및 활동 로깅을 통합합니다.
- **재사용성** – 한 번 구축하여 프로젝트, 클라우드 및 런타임에서 재사용합니다.
- **운영 단순성** – 단일 계약으로 상용구 코드와 유지보수를 줄입니다.

## 시연된 모범 사례

- **비동기 API:** 에이전트 서비스와 PostgreSQL은 비동기 API를 사용하며, FastAPI/ASP.NET/Streamlit과 이상적입니다.
- **토큰 스트리밍:** UI에서 인지되는 대기 시간을 개선합니다.
- **가관측성:** 내장 추적 및 메트릭으로 모니터링 및 최적화를 지원합니다.
- **데이터베이스 보안:** PostgreSQL은 제한된 에이전트 권한과 행 수준 보안(RLS)으로 보안이 유지되어, 에이전트가 인증된 데이터에만 액세스하도록 제한합니다.
- **코드 인터프리터:** [Azure AI 에이전트 서비스 코드 인터프리터](https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/code-interpreter?view=azure-python-preview&tabs=python&pivots=overview){:target="_blank"}는 **샌드박스** 환경에서 LLM 생성 코드를 필요에 따라 실행하여 에이전트 범위를 벗어나는 작업을 방지합니다.

### 확장성

워크샵 패턴은 Foundry에서 데이터베이스 + 에이전트 지침을 업데이트하여 다른 용도(예: 고객 지원)로 적용할 수 있습니다.

## DevTunnel 아키텍처

워크샵 환경에서 에이전트 서비스는 Azure에서 실행되지만 로컬에서 실행 중인 MCP 서버에 연결해야 합니다. DevTunnel은 로컬 MCP 서버를 클라우드 기반 에이전트 서비스에 노출하는 보안 터널을 생성합니다.

```plaintext
          Azure 클라우드                        로컬 개발
    ┌─────────────────────┐                  ┌─────────────────────┐
    │   Zava 에이전트 앱   │                  │                     │
    │   (Azure 호스팅)    │                  │  ┌─────────────────┐│
    │                     │                  │  │   MCP 서버      ││
    │ ┌─────────────────┐ │                  │  │ (sales_analysis)││
    │ │ Azure AI        │ │                  │  │ localhost:8000  ││
    │ │ 에이전트 서비스  │ │                  │  └─────────────────┘│
    │ └─────────────────┘ │                  │           │         │
    └─────────────────────┘                  │           ▼         │
              │                              │  ┌─────────────────┐│
              │ HTTPS 요청                   │  │   PostgreSQL    ││
              ▼                              │  │   + pgvector    ││
    ┌─────────────────────┐                  │  └─────────────────┘│
    │   DevTunnel         │                  │                     │
    │   공용 엔드포인트    │◄─────────────────┼──── 보안 터널        │
    │ (*.devtunnels.ms)   │    포트 포워드   │                     │
    └─────────────────────┘                  └─────────────────────┘
```

**워크샵에서 DevTunnel 작동 방식:**

1. **로컬 개발**: `localhost:8000`에서 로컬로 MCP 서버를 실행합니다
2. **DevTunnel 생성**: DevTunnel은 `localhost:8000`에 연결된 공용 HTTPS 엔드포인트(예: `https://abc123.devtunnels.ms`)를 생성합니다.
3. **Azure 통합**: Azure 호스팅 에이전트 서비스는 DevTunnel 엔드포인트를 통해 MCP 서버에 연결합니다.
4. **투명한 작업**: 에이전트 서비스는 터널을 통해 로컬에서 실행되는 MCP 서버에 액세스하고 있다는 것을 모르고 정상적으로 작동합니다.

이 설정을 통해 다음이 가능합니다:

- 클라우드 호스팅 AI 서비스를 사용하면서 로컬에서 개발 및 디버깅
- MCP 서버를 Azure에 배포하지 않고도 현실적인 시나리오 테스트

*GitHub Copilot을 사용하여 번역됨.*
